<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.6"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Open 3D Engine GradientSignal Gem API Reference: GradientSignal::EditorGradientPreviewUpdateJob Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript">var page_layout=1;</script>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="side-nav" class="ui-resizable side-nav-resizable"><!-- do not remove this div, it is closed by doxygen! -->
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Open 3D Engine GradientSignal Gem API Reference<span id="projectnumber">&#160;23.10.0</span>
   </div>
   <div id="projectbrief">O3DE is an open-source, fully-featured, high-fidelity, modular 3D engine for building games and simulations, available to every industry.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.6 -->
</div><!-- top -->
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('class_gradient_signal_1_1_editor_gradient_preview_update_job.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#pub-types">Public Types</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="class_gradient_signal_1_1_editor_gradient_preview_update_job-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">GradientSignal::EditorGradientPreviewUpdateJob Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p><code>#include &lt;EditorGradientPreviewRenderer.h&gt;</code></p>

<p>Inherits AZ::Job.</p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-types" name="pub-types"></a>
Public Types</h2></td></tr>
<tr class="memitem:a9635cc33c52b6ebac78e5d00a2d88e48"><td class="memItemLeft" align="right" valign="top"><a id="a9635cc33c52b6ebac78e5d00a2d88e48" name="a9635cc33c52b6ebac78e5d00a2d88e48"></a>
using&#160;</td><td class="memItemRight" valign="bottom"><b>SampleFilterFunc</b> = AZStd::function&lt; float(float, const <a class="el" href="struct_gradient_signal_1_1_gradient_sample_params.html">GradientSampleParams</a> &amp;)&gt;</td></tr>
<tr class="separator:a9635cc33c52b6ebac78e5d00a2d88e48"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a54d80a7006b742f2eb2f98fd5c558eb9"><td class="memItemLeft" align="right" valign="top"><a id="a54d80a7006b742f2eb2f98fd5c558eb9" name="a54d80a7006b742f2eb2f98fd5c558eb9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>AZ_CLASS_ALLOCATOR</b> (<a class="el" href="class_gradient_signal_1_1_editor_gradient_preview_update_job.html">EditorGradientPreviewUpdateJob</a>, AZ::ThreadPoolAllocator)</td></tr>
<tr class="separator:a54d80a7006b742f2eb2f98fd5c558eb9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60b582c6558954ffb340c58f331019c9"><td class="memItemLeft" align="right" valign="top"><a id="a60b582c6558954ffb340c58f331019c9" name="a60b582c6558954ffb340c58f331019c9"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>EditorGradientPreviewUpdateJob</b> (AZ::JobContext *context=nullptr)</td></tr>
<tr class="separator:a60b582c6558954ffb340c58f331019c9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a822e45f0d7774fa40486042d5bdb33ca"><td class="memItemLeft" align="right" valign="top"><a id="a822e45f0d7774fa40486042d5bdb33ca" name="a822e45f0d7774fa40486042d5bdb33ca"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>CancelAndWait</b> ()</td></tr>
<tr class="separator:a822e45f0d7774fa40486042d5bdb33ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad4c59ca0707470ecf10fc645dae07533"><td class="memItemLeft" align="right" valign="top"><a id="ad4c59ca0707470ecf10fc645dae07533" name="ad4c59ca0707470ecf10fc645dae07533"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Wait</b> ()</td></tr>
<tr class="separator:ad4c59ca0707470ecf10fc645dae07533"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7db0f1fd7cb0c46a74bb09c34bbfa4a6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_gradient_signal_1_1_editor_gradient_preview_update_job.html#a7db0f1fd7cb0c46a74bb09c34bbfa4a6">ShouldRefreshUI</a> ()</td></tr>
<tr class="separator:a7db0f1fd7cb0c46a74bb09c34bbfa4a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a16148bde9995c112609f618b6e00d6dd"><td class="memItemLeft" align="right" valign="top"><a id="a16148bde9995c112609f618b6e00d6dd" name="a16148bde9995c112609f618b6e00d6dd"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>RefreshPreview</b> (<a class="el" href="class_gradient_signal_1_1_gradient_sampler.html">GradientSampler</a> sampler, SampleFilterFunc filterFunc, QSize imageResolution, QImage *previewImage)</td></tr>
<tr class="memdesc:a16148bde9995c112609f618b6e00d6dd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform any main-thread and one-time setup needed to refresh the preview, then kick off the job. <br /></td></tr>
<tr class="separator:a16148bde9995c112609f618b6e00d6dd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3a765be25d97f8652c461ab926e5c5bf"><td class="memItemLeft" align="right" valign="top"><a id="a3a765be25d97f8652c461ab926e5c5bf" name="a3a765be25d97f8652c461ab926e5c5bf"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>Process</b> () override</td></tr>
<tr class="memdesc:a3a765be25d97f8652c461ab926e5c5bf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Process runs exactly once for each time Start() is called on a Job, and processes on a Job worker thread. <br /></td></tr>
<tr class="separator:a3a765be25d97f8652c461ab926e5c5bf"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><a class="el" href="class_gradient_signal_1_1_editor_gradient_preview_update_job.html">EditorGradientPreviewUpdateJob</a> offloads the creation of a gradient preview image to another thread. This is necessary for Editor responsiveness. With complex gradient hierarchies, large previews, and/or multiple gradient previews visible at the same time (like in Landscape Canvas), it's possible for the preview generation to take multiple seconds, or even minutes in degenerate data cases.</p>
<p>In offloading the work, we also incrementally update the preview via an adaptive interlacing scheme, similar to GIF or PNG interlacing, so that it becomes visible and usable even before the work has completed.</p>
<p>Implementation notes:</p><ul>
<li>This directly modifies the m_previewImage from a Job thread in a non-threadsafe way while it is also being used from Qt in the main thread. This doesn't cause any issues because we synchronously cancel the job thread any time we delete or recreate m_previewImage (such as during resizing).</li>
<li>The interlacing scheme is loosely based on the "Adam7" algorithm, which is used in the PNG format. Unlike Adam7, which uses a 7-pass system to operate on 8x8 interlace patterns, the code below uses an N-pass system. Roughly speaking, each pass doubles the number of pixels drawn relative to the previous pass. For a 256x256 image, the passes will draw 1 pixel, 1 pixel, 2 pixels, 4 pixels, 8 pixels, 16 pixels, 32 pixels, 64 pixels, 128 pixels, ..., 32768 pixels.</li>
<li>We only create a single job instance per gradient preview, and the <a class="el" href="class_gradient_signal_1_1_editor_gradient_preview_update_job.html#a3a765be25d97f8652c461ab926e5c5bf" title="Process runs exactly once for each time Start() is called on a Job, and processes on a Job worker thr...">Process()</a> function of the job runs once for each time we need to refresh the preview. It remains dormant the rest of the time. We can't use a fire-and-forget job because we need the ability to synchronously cancel it and wait for it to be cancelled. This requirement comes from the way we reuse data that exists in the parent Preview widget class. We need to manage the lifetime to be exactly the same as the widget, and we can't have multiple jobs running in parallel that modify the same widget. (If we use fire-and-forget, even if we cancel asynchronously, it would be easy to start a new one before the old one finishes) </li>
</ul>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a id="a7db0f1fd7cb0c46a74bb09c34bbfa4a6" name="a7db0f1fd7cb0c46a74bb09c34bbfa4a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7db0f1fd7cb0c46a74bb09c34bbfa4a6">&#9670;&#160;</a></span>ShouldRefreshUI()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool GradientSignal::EditorGradientPreviewUpdateJob::ShouldRefreshUI </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">
<p>This enables our widget to know whenever the preview image has changed. We also clear the refreshUI flag here on polling, so that we only detect changes since the last time we asked. We don't rely on watching for the thread to be running, since it's possible for the thread to run and finish before we ever poll for the first time. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>Gems/GradientSignal/Code/Include/GradientSignal/Editor/EditorGradientPreviewRenderer.h</li>
</ul>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><b>GradientSignal</b></li><li class="navelem"><a class="el" href="class_gradient_signal_1_1_editor_gradient_preview_update_job.html">EditorGradientPreviewUpdateJob</a></li>
    <li class="footer">Generated on Mon Oct 9 2023 13:49:22 for Open 3D Engine GradientSignal Gem API Reference by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.6 </li>
  </ul>
</div>
</body>
</html>
